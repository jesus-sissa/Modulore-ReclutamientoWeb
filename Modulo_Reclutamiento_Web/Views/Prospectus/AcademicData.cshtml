@using Modulo_Reclutamiento_Web.Models.GeneralData
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model AcademicData
@{
    int _action = 2;//actualizar
    if (Model.SchoolName == null)
    {
        _action = 1;//insertar
    }
}

<div class="page-header">
    <div class="page-title">
        <ol class="breadcrumb" style="float:left">
            <li class="breadcrumb-item"><a href="@Url.Action("AdditionalInformation","Prospectus",new{ pto = ViewBag.pto})"><i class="ti-arrow-left"></i> Regresar</a></li>
        </ol>
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Reclutador</a></li>
            <li class="breadcrumb-item active">Prospectos</li>
            <li class="breadcrumb-item active">Procesos</li>
            <li class="breadcrumb-item active">Informacion Adicional</li>
            <li class="breadcrumb-item active">Escolares</li>
        </ol>
    </div>
</div>

<div class="card">
    <div class="card-title">
        <h4>Datos Academicos y Cursos</h4>
    </div>
    <div class="card-body">
        <ul class="nav nav-tabs customtab2" role="tablist">
            <li class="nav-item">
                <a class="nav-link active show" data-toggle="tab" href="#datAcademic" role="tab" aria-selected="true">
                    <span class="hidden-sm-up"><i class="ti-layout-media-overlay"></i></span>
                    <span class="hidden-xs-down">Datos Academicos</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="coursetab" data-toggle="tab" href="#datCurs" role="tab" aria-selected="true">
                    <span class="hidden-sm-up"><i class="ti-user"></i></span>
                    <span class="hidden-xs-down">Cursos</span>
                </a>
            </li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active show" id="datAcademic" role="tabpanel">
                <div class="p-20">

                    <div class="basic-form">
                        <form  id="frmAcademic" asp-action="AcademicDataSave" asp-controller="Prospectus" method="post">
                            <input type="hidden" asp-for="@Model.Action" value="@_action" />
                            <input type="hidden" asp-for="@Model.Id" value="@ViewBag.pto" />
                            <div class="form-group">
                                <label asp-for="@Model.LastDegreeStudy" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.LastDegreeStudy" asp-items="@(new SelectList(Model.LastDegreeStudyOp, "Value","Text",Model.LastDegreeStudy))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.DocumentReceived" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.DocumentReceived" asp-items="@(new SelectList(Model.DocumentsReceivedOp, "Value","Text",Model.DocumentReceived))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.SchoolName" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.SchoolName" class=" validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Career" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Career" class="validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.ProfessionalID" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.ProfessionalID" class="validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Speciality" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Speciality" class="validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.StartYear" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.StartYear" asp-items="@(new SelectList(Model.StartYearsOp, "Value","Text",Model.StartYear))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.FinishYear" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.FinishYear" asp-items="@(new SelectList(Model.FinishYearsOp, "Value","Text",Model.FinishYear))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Folio" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Folio" class="validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.SchoolAverage" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.SchoolAverage" class=" validarAcad form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                @if (_action == 1)
                                {
                                    <input id="btn_academic" type="button" class="btn btn-success input-rounded" value="Agregar" />
                                }
                                else
                                {
                                    <input id="btn_academic" type="button" class="btn btn-success input-rounded" value="Actualizar" />
                                }


                            </div>
                        </form>

                    </div>

                </div>
            </div>
            <div class="tab-pane p-20" id="datCurs" role="tabpanel">
                <div class="p-20">
                    <div class="basic-form">
                        <form id="frm_courses">
                            <input type="hidden" asp-for="@Model.Courses.Id" value="@ViewBag.pto" />
                            <div class="form-group">
                                <label asp-for="@Model.Courses.TypeCourse" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.Courses.TypeCourse" asp-items="@(new SelectList(Model.Courses.TypeCourseOp, "Value","Text",Model.Courses.TypeCourse))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.Name" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Courses.Name" class="validarCurso form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.StartDate" class="text-muted m-b-15 f-s-12"></label>
                                <input type="date" asp-for="@Model.Courses.StartDate" autocomplete="off" value="@DateTime.Today.ToString("yyyy-MM-dd")" class="form-control input-rounded" />
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.FinishDate" class="text-muted m-b-15 f-s-12"></label>
                                <input type="date" asp-for="@Model.Courses.FinishDate" autocomplete="off" value="@DateTime.Today.ToString("yyyy-MM-dd")" class="form-control input-rounded" />
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.Finished" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control" asp-for="@Model.Courses.Finished" asp-items="@(new SelectList(Model.Courses.FinishedOp, "Value","Text",Model.Courses.Finished))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.Instructor" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Courses.Instructor" class=" validarCurso form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.DocucumentReceived" class="text-muted m-b-15 f-s-12"></label>
                                <select class="form-control input-rounded" asp-for="@Model.Courses.DocucumentReceived" asp-items="@(new SelectList(Model.Courses.DocucumentReceivedOp, "Value","Text",Model.Courses.DocucumentReceived))"></select>
                            </div>
                            <div class="form-group">
                                <label asp-for="@Model.Courses.Comments" class="text-muted m-b-15 f-s-12"></label>
                                <input type="text" asp-for="@Model.Courses.Comments" class="form-control input-rounded" placeholder="">
                            </div>
                            <div class="form-group">
                                <input id="btn_courses" type="button" class="btn btn-success input-rounded" value="Agregar" />
                            </div>
                        </form>
                    </div>


                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="hidden">#</th>
                                    <th>Curso</th>
                                    <th>Fecha Inicio</th>
                                    <th>Fecha Fin</th>
                                    <th>Finalizado</th>
                                    <th>Instructor</th>
                                    <th>Comentarios</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.CoursesList.Count > 0)
                                {
                                    @foreach (var item in Model.CoursesList)
                                    {
                                        <tr>
                                            <th scope="row" class="hidden">@item.Id</th>
                                            <td>@item.Name</td>
                                            <td>@item.StartDate</td>
                                            <td>@item.FinishDate</td>
                                            <td>@item.FinishedOp.Where(x=>x.Value ==((item.Finished=="SI")?"S":"N")).First().Text</td>
                                            <td>@item.Instructor</td>
                                            <td>@item.Comments</td>
                                            <td>
                                                <a id="@item.Id" class="delcourse btn btn-danger btn-rounded" style="color:#fff"><i class="ti-trash"></i> Eliminar </a>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <th scope="row" class="hidden"></th>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                        <td>No Data</td>
                                    </tr>

                                }



                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>


    </div>
</div>


@section Scripts
    {
    <script type="text/javascript">
        /**
         *  GENERAL
         */
        $(document).ready(function() {
            if ("@ViewBag.MSG" === "1") {
                swal("Datos Escolares Agregados!", "", "success");
            }
            if ("@ViewBag.MSG" === "2") {
                swal("Datos Escolares Actualizados!", "", "success");
            }
            if ("@ViewBag.MSG" === "0") {
                sweetAlert("Oops...", "No se pudo Agregar el Dato Escolar !!", "error");
            }
            if (sessionStorage.getItem("deleteClick") === 'true') {
                $("#coursetab").click()
            }
        });

        /***
         *  DATOS ACADEMICOS
         */
        // VALIDACIONES
        $(".validarAcad").on("focus", function() {
            //console.log("event focus")
            if ($(this).val() === "" || $(this).val() === "0") {
                $(this).attr("style", "border-color:red")
            } else {
                if ($(this).val() !== "" || $(this).val() !== "0") {
                    $(this).attr("style", "border-color:green")
                }
                else {
                    $(this).removeAttr("style")
                }

            }
        });

        $("#btn_academic").click(function() {
            event.preventDefault();

            if ($("#SchoolName").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#SchoolName").attr("style", "border-color:red")
                return false;
            }
            if ($("#Career").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#Career").attr("style", "border-color:red")
                return false;
            }
            if ($("#ProfessionalID").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#ProfessionalID").attr("style", "border-color:red")
                return false;
            }
            if ($("#Speciality").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#Speciality").attr("style", "border-color:red")
                return false;
            }
            if ($("#Folio").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#Folio").attr("style", "border-color:red")
                return false;
            }
            if ($("#SchoolAverage").val() === "") {
                msgError("Nombre de la escuela no puede ir vacio")
                $("#SchoolAverage").attr("style", "border-color:red")
                return false;
            }

            $("#frmAcademic").submit();
        });


        /**
         *  CURSOS
         */
        //VALIDACIONES
        $(".validarCurso").on("focus", function() {
            //console.log("event focus")
            if ($(this).val() === "" || $(this).val() === "0") {
                $(this).attr("style", "border-color:red")
            } else {
                if ($(this).val() !== "" || $(this).val() !== "0") {
                    $(this).attr("style", "border-color:green")
                }
                else {
                    $(this).removeAttr("style")
                }

            }
        }).on("change keyup paste", function() {
            //console.log("event change keyup paste")
            if ($(this).val() !== "") {
                $(this).removeAttr("style")
                $(this).attr("style", "border-color:green")
            }
        });



        $("#btn_courses").click(function() {
            if ($("#Courses_Name").val() === "") {
                msgError("Nombre de curso no puede ir vacio")
                $("#Courses_Name").attr("style", "border-color:red")
                return false;
            }
            if ($("#Courses_Instructor").val() === "") {
                msgError("Nombre no instructor no puede ir vacio")
                $("#Courses_Instructor").attr("style", "border-color:red")
                return false;
            }

            AddCourse()

        });

        $(".delcourse").click(function() {
            var _id = $(this).attr("id");
            DeleteCourse(_id)
        });

        function AddCourse() {

            $.ajax({
                type: "POST",
                url: "@Url.Action("SaveDataCourse","Prospectus")",
                data: $("#frm_courses").serialize(),

                success: function(data) {
                    //console.log(data)

                    if (data) {
                        swal("Curso Agregado!", "", "success");
                        sessionStorage.setItem("deleteClick", true);
                    }
                    else {
                        sweetAlert("Oops...", "No se pudo Agregar el Curso !!", "error");
                        sessionStorage.setItem("deleteClick", false);
                    }
                    //$("#ModalConfirmacionReset").modal("hide");
                    if (sessionStorage.getItem("deleteClick") === 'true') {
                        setTimeout(function() {
                            window.location.reload();
                        }, 3000);
                    }

                },
                error: function(error) {
                    console.log(error.status)
                    if (error.status == 403) {
                        alert("No autorizado para hacer esta accion")
                    }
                    if (error.status == 404) {
                        alert("Accion No Disponible")
                    }
                    if (error.status == 500) {
                        alert("Error de Servidor")
                    }
                    //alert("Error al firmar")
                    //window.location.href ="/cajerosinteligentesQA/Home/Index"
                },
                complete: function(xhr, textStatus) {
                    console.log(xhr.status);
                }
            });
        }

        function DeleteCourse(_id) {

            $.ajax({
                type: "POST",
                url: "@Url.Action("DeleteDataCourse","Prospectus")",
                data: { id: _id },

                success: function(data) {
                    //console.log(data)

                    if (data) {
                        swal("Curso removido!", "", "success");
                        sessionStorage.setItem("deleteClick", true);
                    }
                    else {
                        sweetAlert("Oops...", "No se pudo Agregar el Curso !!", "error");
                        sessionStorage.setItem("deleteClick", false);
                    }
                    //$("#ModalConfirmacionReset").modal("hide");
                    if (sessionStorage.getItem("deleteClick") === 'true') {
                        setTimeout(function() {
                            window.location.reload();
                        }, 3000);
                    }



                },
                error: function(error) {
                    console.log(error.status)
                    if (error.status == 403) {
                        alert("No autorizado para hacer esta accion")
                    }
                    if (error.status == 404) {
                        alert("Accion No Disponible")
                    }
                    if (error.status == 500) {
                        alert("Error de Servidor")
                    }
                    //alert("Error al firmar")
                    //window.location.href ="/cajerosinteligentesQA/Home/Index"
                },
                complete: function(xhr, textStatus) {
                    console.log(xhr.status);
                }
            });
        }

    </script>
}