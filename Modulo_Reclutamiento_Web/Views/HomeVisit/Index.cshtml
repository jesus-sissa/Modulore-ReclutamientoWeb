@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
<div class="page-header">
    <div class="page-title">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="#">Reclutador</a></li>
            <li class="breadcrumb-item active">Visita Domiciliaria</li>
        </ol>
    </div>
</div>
<div class="row">
    <div class="col-lg-12 col-xl-12">                              
        <div class="card">
            <div class="card-body">
                <div class="form-group">
                    <label class="">Filtro</label>
                    <select id="hvop" class="form-control input-rounded" name="hvop" asp-items="@(new SelectList(ViewBag.VisitOp, "Value","Text"))"></select>
                </div>
                <div class="form-group">
                    <label class="">Departamento</label>
                    <select id="departs" disabled class="form-control input-rounded" name="" asp-items="@(new SelectList(ViewBag.Departs, "Value","Text"))"></select>
                </div>
                <div id="positions" class="form-group">
                    <label class="">Puesto</label>
                    <select id="position" disabled class="form-control input-rounded" name="" asp-items="@(new SelectList(ViewBag.Positions, "Value","Text"))"></select>
                </div>
                <form method="post" id="busqueda" class="form-inline" asp-controller="HomeVisit" asp-action="Index">
                    <input type="hidden" id="homevisitop" name="homevisitop" value="" />
                    <input type="hidden" id="departop" name="departop" value="" />
                    <input type="hidden" id="positop" name="positop" value="" />

                    <div class="form-group col-md-4">
                        <label for="Fecha_Inicio">Fecha Inicio</label>
                        <input type="date" name="Fecha_Inicio" autocomplete="off" value="@DateTime.Today.AddDays(-14).ToString("yyyy-MM-dd")" id="Fecha_Inicio" class="form-control input-rounded form-control-file" />
                    </div>
                    <div class="form-group col-md-4">
                        <label for="Fecha_Fin">Fecha Fin</label>
                        <input type="date" name="Fecha_Fin" autocomplete="off" value="@DateTime.Today.ToString("yyyy-MM-dd")" id="Fecha_Fin" class="form-control input-rounded form-control-file" />
                    </div>
                    <div class="form-group col-md-4">
                        <button id="buscar" type="button" class="btn btn-sissa btn-rounded form-control-file"><i class="ti-search"></i> Buscar</button>
                    </div>

                </form>
            </div>
        </div>
    </div>

</div>


@if (@Model != null)
{

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-title">
                    <h4>Empleados </h4>

                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Nombre</th>
                                    <th>Departamento</th>
                                    <th>Puesto</th>
                                    @if (ViewBag.TypeList == "P")
                                    {
                                        <th>Fecha</th>
                                    }

                                    <th>Accion</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in Model)
                                {
                                    <tr>


                                        <th>@item.Name</th>
                                        <th>@item.Department</th>
                                        <th>@item.Position</th>
                                        @if (ViewBag.TypeList == "P")
                                        {
                                            <th>@item.Date</th>
                                            <th class="text-right">
                                                <!-- prospecto -->
                                                <a href="@Url.Action("ListOfVisits","HomeVisit",new{ pto =@item.Id,filter=1,stat="R"})" class="btn btn-sissa btn-rounded" style="color:white"><i class="ti-eye"></i> Ver </a>
                                                @*                 <a href="@Url.Action("Research","Recruiter",new{ prosp =@item.Key,filter=1,stat="N"})" class="btn btn-sissa-green-light btn-rounded" style="color:white"><i class="ti-clipboard"></i> Nueva </a>
                                    <a href="@Url.Action("Research","Recruiter",new{ prosp =@item.Key,filter=1,stat="U"})" class="btn btn-sissa-blue-light btn-rounded" style="color:white"><i class="ti-clipboard"></i> Ultima </a>*@
                                            </th>
                                        }
                                        else
                                        {
                                            <th class="text-right">

                                                <a href="@Url.Action("ListOfVisits","HomeVisit",new{ pto =@item.Id,filter=2,stat="R"})" class="btn btn-sissa btn-rounded" style="color:white"><i class="ti-eye"></i> Ver </a>
                                                @*<a href="@Url.Action("Research","Recruiter",new{ prosp =@item.Id,filter=2,stat="N"})" class="btn btn-sissa-green-light btn-rounded" style="color:white"><i class="ti-clipboard"></i> Nueva </a>
                                    <a href="@Url.Action("Research","Recruiter",new{ prosp =@item.Id,filter=2,stat="U"})" class="btn btn-sissa-blue-light btn-rounded" style="color:white"><i class="ti-clipboard"></i> Ultima </a>*@
                                            </th>
                                        }



                                    </tr>
                                }

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
}


@section Scripts
    {
    <script type="text/javascript">
        $(document).ready(function() {
            if ($("#hvop").val() == "2") {
                $("#Fecha_Inicio").attr('disabled', 'disabled')
                $("#Fecha_Fin").attr('disabled', 'disabled')

                $("#departs").removeAttr('disabled')
                $("#position").removeAttr('disabled')
            }
            else {
                $("#departs").attr('disabled', 'disabled')
                $("#position").attr('disabled', 'disabled')

                $("#Fecha_Inicio").removeAttr('disabled')
                $("#Fecha_Fin").removeAttr('disabled')
            }
        });

        $("#buscar").click(function() {
            var type = $("#hvop").val();
            var valDep = $("#departs").val();
            var valPos = $("#position").val();

            $("#homevisitop").val(type)
            $("#departop").val(valDep)
            $("#positop").val(valPos)


            $("#busqueda").submit();

        });


        $("#hvop").click(function() {

            var optval = $(this).val();

            if (optval === "2") {
                $("#Fecha_Inicio").attr('disabled', 'disabled')
                $("#Fecha_Fin").attr('disabled', 'disabled')

                $("#departs").removeAttr('disabled')
                $("#position").removeAttr('disabled')

            } else {
                $("#departs").attr('disabled', 'disabled')
                $("#position").attr('disabled', 'disabled')

                $("#Fecha_Inicio").removeAttr('disabled')
                $("#Fecha_Fin").removeAttr('disabled')
            }


            $("#op").val(optval)

        });

        $("#departs").change(function() {
            var _department = $(this).val(); +
                console.log("departamento:" + _department)
            UpdatePosition(_department);

        });


        function UpdatePosition(_department) {
            $("#positions").empty();
            $.ajax({
                type: "POST",
                url: "@Url.Action("selectPositionHomeVisit","Recruiter")",
                data: { department: _department },

                success: function(data) {
                    console.log(data)

                    $("#positions").html(data);
                    //if (data) {
                    //    alert("Proceso Reiniciado")
                    //}
                    //else {
                    //    alert("Contraseña Incorrecta")
                    //}
                    //$("#ModalConfirmacionReset").modal("hide");

                },
                error: function(error) {
                    console.log(error.status)
                    if (error.status == 403) {
                        alert("No autorizado para hacer esta accion")
                    }
                    if (error.status == 404) {
                        alert("Accion No Disponible")
                    }
                    if (error.status == 500) {
                        alert("Error de Servidor")
                    }
                    //alert("Error al firmar")
                    //window.location.href ="/cajerosinteligentesQA/Home/Index"
                },
                complete: function(xhr, textStatus) {
                    console.log(xhr.status);
                }
            });
        }


    </script>
}